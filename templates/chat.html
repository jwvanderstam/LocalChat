{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">Chat Interface</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="form-check form-switch me-3">
            <input class="form-check-input" type="checkbox" id="rag-toggle" checked>
            <label class="form-check-label" for="rag-toggle">
                <i class="bi bi-database me-1"></i>RAG Mode
            </label>
        </div>
        <button class="btn btn-sm btn-outline-primary me-2" id="copy-chat-btn" title="Copy chat to clipboard">
            <i class="bi bi-clipboard me-1"></i>Copy Chat
        </button>
        <button class="btn btn-sm btn-outline-danger" id="clear-chat-btn">
            <i class="bi bi-trash me-1"></i>Clear Chat
        </button>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card" style="height: calc(100vh - 250px);">
            <div class="card-body d-flex flex-column">
                <!-- Chat Messages Area -->
                <div id="chat-messages" class="flex-grow-1 overflow-auto mb-3 p-3 border rounded bg-light">
                    <div class="text-center text-muted">
                        <i class="bi bi-chat-dots fs-1"></i>
                        <p class="mt-2">Start a conversation...</p>
                        <p class="small">
                            <span class="badge bg-primary" id="mode-badge">RAG Mode: ON</span>
                        </p>
                    </div>
                </div>
                
                <!-- Input Area -->
                <form id="chat-form" class="d-flex gap-2">
                    <input type="text" class="form-control" id="chat-input" 
                           placeholder="Type your message..." autocomplete="off">
                    <button type="submit" class="btn btn-primary" id="send-btn">
                        <i class="bi bi-send"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Message Templates -->
<template id="user-message-template">
    <div class="message user-message mb-3">
        <div class="d-flex justify-content-end">
            <div class="message-content bg-primary text-white p-3 rounded" style="max-width: 70%;">
                <div class="message-text"></div>
                <small class="message-time text-white-50 d-block mt-1"></small>
            </div>
        </div>
    </div>
</template>

<template id="assistant-message-template">
    <div class="message assistant-message mb-3">
        <div class="d-flex">
            <div class="message-content bg-white border p-3 rounded" style="max-width: 70%;">
                <div class="message-text"></div>
                <small class="message-time text-muted d-block mt-1"></small>
            </div>
        </div>
    </div>
</template>

<template id="loading-template">
    <div class="message loading-message mb-3">
        <div class="d-flex">
            <div class="message-content bg-white border p-3 rounded">
                <div class="spinner-border spinner-border-sm me-2" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <span class="text-muted">Thinking...</span>
            </div>
        </div>
    </div>
</template>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
